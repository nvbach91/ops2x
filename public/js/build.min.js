var App=App||{};!function(e){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),function(e){e.fn.scannerDetection=function(t){if("string"==typeof t)return this.each(function(){this.scannerDetectionTest(t)}),this;var a={onComplete:!1,onError:!1,onReceive:!1,timeBeforeScanTest:100,avgTimeByChar:30,minLength:6,endChar:[9,13],stopPropagation:!1,preventDefault:!1};return"function"==typeof t&&(t={onComplete:t}),t="object"!=typeof t?e.extend({},a):e.extend({},a,t),this.each(function(){var a=this,i=e(a),n=0,p=0,r="",s=!1,d=!1,o=function(){n=0,r=""};a.scannerDetectionTest=function(e){return e&&(n=p=0,r=e),r.length>=t.minLength&&p-n<r.length*t.avgTimeByChar?(t.onComplete&&t.onComplete.call(a,r),i.trigger("scannerDetectionComplete",{string:r}),o(),!0):(t.onError&&t.onError.call(a,r),i.trigger("scannerDetectionError",{string:r}),o(),!1)},i.data("scannerDetection",{options:t}).unbind(".scannerDetection").bind("keydown.scannerDetection",function(e){if(n&&-1!==t.endChar.indexOf(e.which)){var a=jQuery.Event("keypress",e);a.type="keypress.scannerDetection",i.triggerHandler(a),e.preventDefault(),e.stopImmediatePropagation()}}).bind("keypress.scannerDetection",function(e){t.stopPropagation&&e.stopImmediatePropagation(),t.preventDefault&&e.preventDefault(),n&&-1!==t.endChar.indexOf(e.which)?(e.preventDefault(),e.stopImmediatePropagation(),s=!0):(r+=String.fromCharCode(e.which),s=!1),n||(n=Date.now()),p=Date.now(),d&&clearTimeout(d),s?(a.scannerDetectionTest(),d=!1):d=setTimeout(a.scannerDetectionTest,t.timeBeforeScanTest),t.onReceive&&t.onReceive.call(a,e),i.trigger("scannerDetectionReceive",{evt:e})})}),this}}(jQuery),App.getWindowWidth=function(){return window.innerWidth},App.getAnimationTime=function(){return App.getWindowWidth()>799?100:0},Array.prototype.binaryIndexOf=function(e,t){"use strict";for(var a,i,n=0,p=this.length-1;p>=n;)if(a=(n+p)/2|0,i=this[a],i[e]<t)n=a+1;else{if(!(i[e]>t))return a;p=a-1}return-1},String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)},Number.prototype.formatMoney=function(e,t,a){var i=this,e=isNaN(e=Math.abs(e))?2:e,t=void 0===t?".":t,a=void 0===a?"":a,n=0>i?"-":"",p=parseInt(i=Math.abs(+i||0).toFixed(e))+"",r=(r=p.length)>3?r%3:0;return n+(r?p.substr(0,r)+a:"")+p.substr(r).replace(/(\d{3})(?=\d)/g,"$1"+a)+(e?t+Math.abs(i-p).toFixed(e).slice(2):"")},App.correctTime=function(e){return 10>e?"0"+e:e},App.week=[{"short":"Mon","long":"Monday"},{"short":"Tue","long":"Tuesday"},{"short":"Wed","long":"Wednesday"},{"short":"Thu","long":"Thursday"},{"short":"Fri","long":"Friday"},{"short":"Sat","long":"Saturday"},{"short":"Sun","long":"Sunday"}],App.createDateObject=function(e){var t=null;return t=e?new Date(e):new Date,{day:App.week[t.getDay()]["short"],date:App.correctTime(t.getDate()),month:App.correctTime(t.getMonth()+1),year:App.correctTime(t.getFullYear()),hh:App.correctTime(t.getHours()),mm:App.correctTime(t.getMinutes()),ss:App.correctTime(t.getSeconds())}},App.getDate=function(e){var t=App.createDateObject(e);return t.day+" "+t.date+"/"+t.month+"/"+t.year+" "+t.hh+":"+t.mm+":"+t.ss},App.getDatePrefix=function(){var e=App.createDateObject();return e.year+""+e.month+e.date},App.startReceiptTime=function(){clearInterval(App._receiptTimeInterval),App._receiptTimeInterval=setInterval(function(){App.receiptTime.text(App.getDate())},500)},App.sortByEAN=function(e,t){return e.ean<t.ean?-1:1},App.beep=function(){App.isMuted||(App.beeper.pause(),App.beeper.currentTime=0,App.beeper.play())},App.correctPrice=function(e){var t=e,a=t.indexOf(".");if(a>0){var i=t.slice(0,a),n=t.slice(a+1,t.length);return n.length>2?n=n.slice(0,2):n.length>1||(n+=n.length>0?"0":"00"),i+"."+n}t=e.replace(/\./g,"");for(var p="";t.length>2&&"0"===t.charAt(0);)t=t.slice(1);return 0===parseInt(t)?"0.00":(t.length>2?p=t.slice(0,t.length-2)+"."+t.slice(t.length-2,t.length):t.length>1?p="0."+t:t.length>0&&(p="0.0"+t),p)},App.recalculateTotalCost=function(){1===App.jSaleList.children().size()&&App.jSiPlaceholder.removeClass("hidden");var e=0,t=0;App.jSaleList.find(".sale-item").each(function(){var e=$(this),a=parseInt(e.find(".si-quantity").val());t+=a;var i=parseFloat(e.find(".si-price").text()),n=i*a,p=e.find(".d-discount").val()/100;n-=n*p,n.toFixed(2),e.find(".si-total").text(n.formatMoney())}),App.jSaleList.find(".sale-item .si-total").each(function(){e+=parseFloat($(this).text())}),e.toFixed(2);var a=e.formatMoney();App.jCheckoutTotal.text("Total: "+a+" "+App.settings.currency.symbol),App.jPayAmount.text(a),App.jCheckoutLabel.text("CHECKOUT ("+t+" item"+(1!==t?"s":"")+")")},App.correctPriceInput=function(){var e=App.jPriceInput.val();if(!/^\-?\d+\*?(\d+)?\.?(\d+)?$/g.test(e)||"-"===e)return App.jPriceInput.val(""),!1;var t=e.indexOf("*");if(e.indexOf("*")>=0){var a=App.getMultiplicationNumber(),i=t>=0?e.slice(t+1,e.length):e;return i.length&&/^0+$/.test(i)&&(i=""),App.jPriceInput.val(a+"*"+App.correctPrice(i)),!0}var n="";"-"===e.charAt(0)&&(e=e.slice(1),n="-");var p=App.correctPrice(e);return p?void App.jPriceInput.val(n+p):(App.jPriceInput.val(""),!1)},App.checkPriceInput=function(e){return e.stopPropagation(),App.jKc.text("keyCode: "+e.keyCode),27===e.keyCode?(App.jPriceInput.blur(),!0):13===e.keyCode?(App.jPriceInput.val().length&&App.jPriceInput.blur(),!0):8===e.keyCode||9===e.keyCode?!0:109===e.keyCode||189===e.keyCode||173===e.keyCode?App.jPriceInput.val().length>0?!1:!0:229===e.keyCode?!1:106===e.keyCode?0===App.jPriceInput.val().length||App.jPriceInput.val().length>3?!1:App.jPriceInput.val().indexOf("*")<0?!0:!1:110===e.keyCode?0===App.jPriceInput.val().length?!1:App.jPriceInput.val().indexOf(".")<0?!0:!1:void((e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault())},App.checkNumericInput=function(e,t){return 13===e.keyCode?(t.blur(),!0):8===e.keyCode?!0:void((e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault())},App.setUpMobileNumericInput=function(e){$.browser.mobile},App.closeCurtain=function(){App.curtain&&(App.jMain?App.jMain.removeClass("blur"):null,App.curtain.remove(),App.curtain=null)},App.showInCurtain=function(e){App.curtain||(App.jMain?App.jMain.addClass("blur"):null,App.curtain=$("<div>").attr("id","curtain").click(function(){App.closeCurtain()}).append(e).appendTo(App.jAppContainer))},App.getMultiplicationNumber=function(){var e=App.jPriceInput.val().replace(/[\s\.]+/g,"");return e.match(/^\-?[1-9](\d+)?\*(\d+)?$/g)?parseInt(e.slice(0,e.indexOf("*"))):1},App.addItemToCheckout=function(e,t,a,i,n,p,r,s,d){App.jPayAmount.removeClass("checked");var o=App.jSaleList.find(".sale-item.last");if(e.toString()===o.find(".si-id").text()&&App.isInRegistrySession)return App.incrementLastItem(o),!0;App.jSiPlaceholder.size()&&App.jSiPlaceholder.addClass("hidden"),App.jSaleList.children().size()>0&&App.jSaleList.children().eq(App.jSaleList.children().size()-1).removeClass("last");var l=$("<li>").addClass("sale-item last"),c=$("<div>").addClass("sale-item-main");$("<div>").addClass("si-id").text(e).appendTo(c),$("<div>").addClass("si-ean").text(t).appendTo(c),$("<input>").addClass("si-name").click(function(){$(this).select()}).val(a).appendTo(c),$("<input>").addClass("si-quantity").attr({maxlength:3}).val(d?d:1).keydown(function(e){return e.stopPropagation(),App.checkNumericInput(e,this)}).focus(function(){$(this).select()}).blur(function(){$(this).val()||$(this).val(0),App.recalculateTotalCost()}).appendTo(c),$("<div>").addClass("si-tax").text(p).appendTo(c),$("<div>").addClass("si-price").text(i).appendTo(c),$("<div>").addClass("si-total").text(i).appendTo(c),$("<button>").addClass("si-remove").click(function(){l.slideUp(App.getAnimationTime(),function(){$(this).remove(),App.recalculateTotalCost(),App.jPriceInput.blur()})}).appendTo(c),c.children(".si-price, .si-total").click(function(){l.find(".sale-item-extend").slideToggle(App.getAnimationTime(),function(){var e=$(this);e.is(":hidden")?e.parent().removeClass("expanded"):e.parent().addClass("expanded")})}),c.appendTo(l);var u=$("<div>").addClass("sale-item-extend"),v=$("<div>").addClass("change-price");$("<div>").addClass("d-label").text("Individual Price").appendTo(v),$("<input>").addClass("d-price").attr({maxlength:7,placeholder:"e.g. 4200 = 42.00"}).val(i).keydown(function(e){return e.stopPropagation(),App.checkNumericInput(e,this)}).blur(function(){var e=$(this),t=e.val(),a=App.correctPrice(t);a&&/^\-?\d+\.\d{2}$/g.test(a)?(e.removeClass("invalid"),e.val(a),e.parents().eq(2).find(".si-price").text(a),App.recalculateTotalCost()):e.addClass("invalid")}).focus(function(){$(this).select()}).appendTo(v);var m=$("<div>").addClass("change-discount");$("<div>").addClass("d-label").text("Individual Discount (%)").appendTo(m),$("<input>").addClass("d-discount").attr({maxlength:2,placeholder:"0 - 100",disabled:!0}).val(0).keydown(function(e){return e.stopPropagation(),App.checkNumericInput(e,this)}).blur(function(){var e=$(this);/^\d{1,2}$|^100$/g.test(e.val())?App.recalculateTotalCost():e.val(0)}).focus(function(){$(this).select()}).appendTo(m);var f=$("<div>").addClass("open-detail");$("<div>").addClass("d-label").text("Details").appendTo(f),$("<button>").addClass("d-detail").click(function(){var e=$("<div>").attr("id","details-box").click(function(e){e.stopPropagation()});$("<div>").addClass("db-header").append($("<div>").addClass("db-title").text("Product Details")).append($("<button>").addClass("db-close").click(function(){App.closeCurtain()})).appendTo(e);var t=$("<div>").addClass("db-body"),d=$("<div>").addClass("db-info");$("<div>").addClass("db-name").text("Name: "+a).appendTo(d),$("<div>").addClass("db-price").text("Price: "+i+" "+App.settings.currency.symbol).appendTo(d),$("<div>").addClass("db-group").text("Group: "+n).appendTo(d),$("<div>").addClass("db-tax").text("Tax: "+p+"%").appendTo(d),$("<div>").addClass("db-tags").text("Tags: "+r).appendTo(d),$("<div>").addClass("db-desc").text("Description: "+s).appendTo(d),d.appendTo(t),t.appendTo(e),App.showInCurtain(e)}).appendTo(f),v.appendTo(u),m.appendTo(u),f.appendTo(u),u.hide(),u.appendTo(l),l.appendTo(App.jSaleList),App.jSaleList.animate({scrollTop:App.jSaleList[0].scrollHeight},App.getAnimationTime()),App.recalculateTotalCost(),App.beep()},App.incrementLastItem=function(e){var t=e.find(".si-quantity");t.val(parseInt(t.val())+1),App.recalculateTotalCost(),App.beep()},App.bindSaleGroups=function(e){e.find("button").click(function(){var e=$(this),t=App.jSaleList.find(".sale-item.last");if(t.size()&&e.attr("sg-id")!==t.find(".si-id").text()&&App.isInRegistrySession)return App.jPriceInput.val(""),!1;var a=App.jPriceInput.val();a=a.replace(/[\s]+/g,"");var i=a.indexOf("*"),n=i>=0?a.slice(i+1,a.length):a;if(0===n.length||0===parseInt(n)||"-"===a)return App.jPriceInput.val(""),App.showWarning("You must enter a price"),!1;var p=App.getMultiplicationNumber(),r="";"-"===n.charAt(0)&&(n=n.slice(1),r="-");var s=App.correctPrice(n);if(!s)return App.jPriceInput.val(""),!1;n=App.correctPrice(n),App.jPriceInput.val(r+n);var d=e.attr("sg-id"),o=e.text(),l=e.attr("sg-group"),c=e.attr("sg-tax"),u=e.attr("sg-group"),v=e.text();App.addItemToCheckout(d,"",o,n,l,c,u,v,p),App.isInRegistrySession=!0,App.justUsedScanner=!1})},App.bindQuickSales=function(e){e.find(".qs-item").click(function(){var e=$(this),t=e.find(".qs-price").text().replace(/[^\-\d\.]/g,""),a=App.getMultiplicationNumber();App.jPriceInput.val(t);var i=e.find("button").text(),n=e.find(".qs-id").text(),p=e.find(".qs-tax").text(),r=e.find(".qs-group").text(),s=e.find(".qs-tags").text(),d=e.find(".qs-desc").text();App.addItemToCheckout(n,"",i,t,r,p,s,d,a),App.isInRegistrySession=!0,App.justUsedScanner=!1})},App.showWarning=function(e){var t='<div id="warning-box">                    <div class="wb-header">                        <div class="wb-title"></div>                        <button class="wb-close"></button>                    </div>                    <div class="wb-body">'+e+"</div>                </div>";App.showInCurtain(t),App.curtain.find("#warning-box").click(function(e){e.stopPropagation()}),App.curtain.find("button.wb-close").click(function(){App.closeCurtain()})},App.discardSale=function(e){e?(App.jSaleList.find(".sale-item").remove(),App.recalculateTotalCost()):App.jSaleList.find(".sale-item").slideUp(App.getAnimationTime(),function(){$(this).remove(),App.recalculateTotalCost()})},App.createWebRegisterDOM=function(){var e='<nav>                <div id="logo"><div class="logo"></div></div>                <div id="brand">EnterpriseApps</div>                <div id="menu-top">                    <div id="cp-link" title="Open control panel"></div>                    <div id="muter" title="Mute beep sound"></div>                    <div id="profile">'+(App.currentEmployee.name||"LOGIN")+'</div>                    <div id="logout">Log out</div>                </div>             </nav>             <div id="control-panel">                <div id="cp-header">                   <div class="logo"></div>                   <div class="label">Control Panel</div>                   <div class="close"></div>                </div>                <div id="cp-body"></div>             </div>             <div id="registry-session">1</div>             <div id="main">                <div id="col-1">                    <div id="live-search">                        <input id="search" maxlength="13" placeholder="PLU" autocomplete="off">                        <ul id="dropdown"></ul>                    </div>                    <input id="price-input" placeholder="0.00" maxlength="9">                    <div id="reg-buttons">                        <div id="sale-groups"></div>                        <div id="tabs"></div>                    </div>                    <div id="tab-navs"></div>                </div>                <div id="col-2">                   <div id="checkout-header">                       <div id="checkout-label">CHECKOUT (0 items)</div>                       <div id="checkout-total">Total: 0 '+App.settings.currency.symbol+'</div>                   </div>                   <div id="checkout-btns">                       <button id="park-sale">Park Sale</button>                       <button id="discard-sale">Discard Sale</button>                   </div>                   <ul id="sale-list">                       <li id="si-placeholder">                           <div>Registered items will be dsplayed here</div>                       </li>                   </ul>                   <div id="keyboard" class="keyboard">                        <button id="btnp">PLU</button>                        <button id="btn7">7</button>                        <button id="btn8">8</button>                        <button id="btn9">9</button>                        <button id="btnm"></button>                        <button id="btn4">4</button>                        <button id="btn5">5</button>                        <button id="btn6">6</button>                        <button id="btnn">-</button>                        <button id="btn1">1</button>                        <button id="btn2">2</button>                        <button id="btn3">3</button>                        <button id="btnc">C</button>                        <button id="btndot">.</button>                        <button id="btn0">0</button>                        <button id="btnb"></button>                   </div>                   <div id="paycalc">                       <button id="subtotal">Sub</button>                       <div id="pay">                           <div id="pay-label">Pay</div>                           <div id="pay-amount">0</div>                           <div id="pay-currency">'+App.settings.currency.symbol+'</div>                       </div>                    </div>                </div>             </div>             <div id="kc"></div>';App.jAppContainer.html(e)},App.simulateEnterKeyup=function(){var e=$.Event("keyup");return e.keyCode=13,e},App.bindKeyboard=function(){var e=$("#keyboard"),t=e.find("#btnp"),a=e.find("#btnm");$("#keyboard button").click(function(){App.isInRegistrySession&&(App.isInRegistrySession=!1,App.jPriceInput.val(""));var e=$(this),i=e.attr("id"),n=t.hasClass("activePLU"),p=n?App.jSearchBox:App.jPriceInput,r=n?13:9,s=p.val();switch(i){case"btnp":n?(t.removeClass("activePLU"),App.jLiveSearch.removeClass("activePLU"),App.jPriceInput.show(),a.text("").removeClass("activePLU"),p.val(""),p=App.jPriceInput):(t.addClass("activePLU"),App.jLiveSearch.addClass("activePLU"),App.jPriceInput.hide(),a.text("OK").addClass("activePLU"),p.val(""),p=App.jSearchBox,p.focus());break;case"btnm":n?App.jSearchBox.trigger(App.simulateEnterKeyup()):s.length>0&&s.length<=3&&s.indexOf("*")<0&&"-"!==s&&p.val(s+"*");break;case"btnn":n||0===s.length&&p.val("-");break;case"btnc":p.val("");break;case"btnb":s.length>0&&p.val(s.slice(0,-1));break;case"btndot":s.length>0&&s.indexOf(".")<0&&p.val(s+".");break;default:(s+e.text()).length<=r&&p.val(s+e.text())}App.beep()})},App.loadLocalStorage=function(){localStorage.hasOwnProperty("isMuted")?App.isMuted="true"===localStorage.isMuted:(localStorage.isMuted=!1,App.isMuted=!1)},App.init=function(){App.loadLocalStorage(),App.jAppContainer=$("#app"),App.loadingScreen=$('<div class="loading"></div>'),App.curtain=null,App.justUsedScanner=!1,App._timeBetweenConsecutiveScannings=2e3,$(document).keydown(function(e){return 27===e.keyCode?App.closeCurtain():13===e.keyCode&&App.jControlPanel&&!App.jControlPanel.hasClass("visible")&&(App.curtain||!App.jPriceInput||App.justUsedScanner?App.jCashInput&&App.jCashInput.focus():App.jPriceInput.focus()),!0})},App.renderSaleGroupsButtons=function(){for(var e=App.buttons.saleGroups,t="",a=e.length,i=0;a>i;i++)t+=$("<button>",{"class":"sg","sg-id":"sg"+i,"sg-tax":e[i].tax,"sg-group":e[i].group,text:e[i].group.toUpperCase(),style:"background-color: #"+e[i].bg}).prop("outerHTML");App.sg.html(t),App.bindSaleGroups(App.sg)},App.renderWebRegister=function(){App.closeCurtain(),App.createWebRegisterDOM(),App.bindKeyboard(),App.jMain=$("#main"),App.jSiPlaceholder=$("#si-placeholder"),App.beeper=new Audio("../sound/beep2.mp3"),App.jKc=$("#kc"),App.jSaleList=$("#sale-list"),App.jPriceInput=$("#price-input"),App.jPayAmount=$("#pay-amount"),App.jCheckoutTotal=$("#checkout-total"),App.jCheckoutLabel=$("#checkout-label"),App.jLiveSearch=$("#live-search"),App.jControlPanel=$("#control-panel"),App.cpBody=App.jControlPanel.find("#cp-body"),App.createControlPanel(),App.setUpMobileNumericInput(App.jPriceInput),App.isInRegistrySession=!0;var e=$("#muter");App.isMuted?e.addClass("muted"):e.addClass("unmuted"),e.click(function(){App.isMuted?(e.removeClass("muted"),e.addClass("unmuted"),localStorage.isMuted=!1,App.isMuted=!1):(e.removeClass("unmuted"),e.addClass("muted"),localStorage.isMuted=!0,App.isMuted=!0)});var t=$("#discard-sale");t.click(function(){App.discardSale(!1)}),App.jPriceInput.keydown(function(e){return App.checkPriceInput(e)}).blur(function(){return App.correctPriceInput()}).click(function(){App.jPriceInput.val(""),App.isInRegistrySession=!1}).focus(function(){App.jPriceInput.val(""),App.isInRegistrySession=!1}),App.sg=$("#sale-groups"),App.renderSaleGroupsButtons();for(var a=$("#tabs"),i=$("#tab-navs"),n=App.buttons.tabs,p=n.length,r="",s=[],d=0;p>d;d++){var o=n[d].quickSales,l=o.length;r+='<div class="quick-sales'+(0===d?" activeTab":"")+'">';for(var c=0;l>c;c++){var u=o[c];r+='<div class="qs-item">                        <button style="background-color:#'+u.bg+'">'+u.text+'</button>                        <div class="qs-id">qs-t'+(d+1)+"-"+c+'</div>                        <div class="qs-price">'+u.price+" "+App.settings.currency.symbol+'</div>                        <div class="qs-group">'+u.group+'</div>                        <div class="qs-tax">'+u.tax+'</div>                        <div class="qs-tags">'+u.tags+'</div>                        <div class="qs-desc">'+u.desc+"</div>                    </div>"}r+="</div>",s+='<div class="tab-nav'+(0===d?" activeTab":"")+'">'+n[d].name+"</div>"}a.append(r),App.bindQuickSales(a),i.append(s);var v=a.find(".quick-sales"),m=i.find(".tab-nav");m.each(function(e){var t=$(this);t.click(function(){m.each(function(){$(this).removeClass("activeTab")}),t.addClass("activeTab"),v.each(function(){$(this).removeClass("activeTab")}),v.eq(e).addClass("activeTab")})}),$("#logo > .logo, #cp-link").click(function(){App.jControlPanel.addClass("visible")}),$("#cp-header > .close, #cp-header > .logo, #main").click(function(){App.jControlPanel.removeClass("visible")}),$("#subtotal").click(function(){App.jSaleList.find(".sale-item").size()&&(App.recalculateTotalCost(),App.jPayAmount.addClass("checked"),App.beep())});var f={};$("#pay").click(function(){if(App.jSaleList.find(".sale-item").size()<1)return!1;App.jPriceInput.val("");var e=$("<div>").attr("id","payment-box").click(function(e){e.stopPropagation()});$("<div>").addClass("pb-header").append($("<div>").addClass("pb-title").text("Payment")).append($("<button>").addClass("pb-close").click(function(){App.closeCurtain()})).appendTo(e);var t=$("<div>").addClass("pb-body"),a=$("<div>").addClass("receipt"),i=$('<div class="receipt-header">                    <div class="preview">Receipt Preview</div>                    <div class="company-name">'+App.settings.name+'</div>                    <div class="address-1">'+App.settings.address.street+'</div>                    <div class="address-2">'+App.settings.address.zip+" "+App.settings.address.city+'</div>                    <div class="receipt-row">                        <div class="tin">TIN: '+App.settings.tin+'</div>                        <div class="vat">VAT: '+App.settings.vat+"</div>                    </div>                </div>");$("<div>").addClass("receipt-custom-header").html(App.receipt.header).appendTo(i),$("<div>").attr("id","receipt-number").text("Receipt #"+App.getDatePrefix()+App.sales.receipts.length).appendTo(i),a.append(i);for(var n=$("<ul>").addClass("receipt-body"),p={},r=App.settings.tax_rates.length,s=0;r>s;s++)p[App.settings.tax_rates[s]]={tax:null,total:null};var d=0;f={number:App.getDatePrefix()+App.sales.receipts.length,date:null,clerk:App.currentEmployee.name,items:[],confirmed:!1},App.jSaleList.find(".sale-item").each(function(){var e=$(this),t=e.find(".si-quantity").val();d+=parseFloat(t);var a=e.find(".si-price").text(),i=e.find(".si-name").val(),r=e.find(".si-tax").text();f.items.push({name:i,price:a,quantity:parseInt(t),tax_rate:parseInt(r)});var s=e.find(".si-total").text(),o=$("<li>").addClass("receipt-item").append($("<div>").addClass("ri-n").text(i)).append($("<div>").addClass("ri-v").append($("<div>").addClass("ri-q").text(t)).append($("<div>").addClass("ri-x")).append($("<div>").addClass("ri-p").text(a)).append($("<div>").addClass("ri-tt").text(s)));n.append(o),p[r].tax+=parseFloat(s)*parseFloat(r)/100,p[r].total+=parseFloat(s)});var o=App.jPayAmount.text().replace(/,/g,".").replace(/[^\d\.\-]/g,""),l=Math.round(parseFloat(o)).formatMoney();n.appendTo(a);var c=$("<div>").attr("id","receipt-summary");$("<div>").attr("id","rs-total-items").append($("<div>").addClass("rs-label").text("Total items:")).append($("<div>").addClass("rs-value").text(d)).appendTo(c),$("<div>").attr("id","rs-subtotal").append($("<div>").addClass("rs-label").text("Subtotal:")).append($("<div>").addClass("rs-value").text(o)).appendTo(c),$("<div>").attr("id","rs-total").append($("<div>").addClass("rs-label").text("Total amount:")).append($("<div>").addClass("rs-value").text(l)).appendTo(c),$("<div>").attr("id","rs-tender").append($("<div>").addClass("rs-label").text("Tendered:")).append($("<div>").addClass("rs-value").text(l)).appendTo(c),$("<div>").attr("id","rs-change").append($("<div>").addClass("rs-label").text("Change:")).append($("<div>").addClass("rs-value").text(Number(0).formatMoney())).appendTo(c),$("<div>").attr("id","taxes-label").text("VAT summary:").appendTo(c),$("<div>").attr("id","tax-header").append($("<div>").addClass("th-rate").text("Rate")).append($("<div>").addClass("th-net").text("Net")).append($("<div>").addClass("th-value").text("Tax")).append($("<div>").addClass("th-total").text("Total")).appendTo(c);for(var u=Object.keys(p),v=u.length,s=0;v>s;s++)null!==p[u[s]].tax&&$("<div>").addClass("rs-tax").append($("<div>").addClass("rs-tax-rate").text(u[s]+"%")).append($("<div>").addClass("rs-tax-net").text((p[u[s]].total.toFixed(2)-p[u[s]].tax.toFixed(2)).toFixed(2))).append($("<div>").addClass("rs-tax-tax").text(p[u[s]].tax.toFixed(2))).append($("<div>").addClass("rs-tax-total").text(p[u[s]].total.toFixed(2))).appendTo(c);c.appendTo(a),$("<div>").addClass("receipt-clerk").text("Checked: "+App.currentEmployee.name).appendTo(a),App.receiptTime=$("<div>").attr("id","receipt-time").text(App.getDate()).appendTo(a),App.startReceiptTime(),$("<div>").addClass("receipt-gratitude").text(App.receipt.footer).appendTo(a),$("<div>").addClass("receipt-footer").text("EnterpriseApps").appendTo(a);var m=$("<div>").attr("id","payment");App.jCashInput=$("<input>"),$("<div>").attr("id","cash-pay-topay").text("Total: "+l+" "+App.settings.currency.symbol).click(function(){App.jCashInput.val(l).blur()}).appendTo(m);var A=$("<div>").addClass("cash-quick"),h=$("<div>").attr("id","cash-change");App.changeAmount=0;for(var g=[100,200,500,1e3,2e3,5e3],b=g.length,s=0;b>s;s++)$("<button>").addClass("cash-button").text(g[s]).click(function(){var e=$(this),t=e.text();App.jCashInput.val(t+"00").blur()}).appendTo(A);A.appendTo(m),$("<div>").addClass("cash-pay-label").text("Cash").appendTo(m),App.jCashInput.attr("id","cash-input").attr("placeholder","0.00").attr("maxlength","9").val(l).keydown(function(e){return e.stopPropagation(),27===e.keyCode?(App.jCashInput.blur(),!0):App.checkNumericInput(e,this)}).blur(function(){var t=$(this),a=t.val(),i=App.correctPrice(a);return t.val(i),!i||!/^\-?\d+\.\d{2}$/g.test(i)||parseFloat(i)<parseFloat(l)?(t.addClass("invalid"),m.find("#cash-confirm").addClass("disabled"),!0):(t.removeClass("invalid"),m.find("#cash-confirm").removeClass("disabled"),App.changeAmount=(parseFloat(t.val())-parseFloat(l)).formatMoney(),h.text("Change: "+App.changeAmount+" "+App.settings.currency.symbol),e.find("#rs-tender .rs-value").text(t.val()),void e.find("#rs-change .rs-value").text(App.changeAmount))}).focus(function(){$(this).select()}).appendTo(m),App.setUpMobileNumericInput(App.jCashInput),h.text("Change: "+Number(0).formatMoney()+" "+App.settings.currency.symbol).appendTo(m);var y=!1;$("<button>").attr("id","cash-confirm").text("CONFIRM PAYMENT").click(function(){var e=$(this);e.off(),e.hasClass("disabled")||(clearInterval(App._receiptTimeInterval),f.date=new Date,f.items=JSON.stringify(f.items),f.tendered=App.jCashInput.val(),$.ajax({type:"POST",url:"/mod/addsale",dataType:"json",data:f}).done(function(e){if(e.success){App.sales.receipts.push(e.msg),m.children().remove(),App.discardSale(!0),$("<div>").addClass("pc-label").text("Sale complete!").appendTo(m),"0.00"!==App.changeAmount&&$("<div>").addClass("pc-change").text("Issue change of "+App.changeAmount+" "+App.settings.currency.symbol).appendTo(m),$("<button>").attr("id","print-receipt").text("Print receipt").click(function(){window.print(),y=!0}).appendTo(m);var t=$("<div>").addClass("email-receipt").appendTo(m),a=$("<input>").attr("id","email-input").focus(function(){a.removeClass("invalid"),"@"!==a.val()&&(a.val("@"),a.select())}).val("@").appendTo(t),i=$("<button>").attr("id","email-send").text("Email receipt").click(function(){var e=a.val();App.isValidEmail(e)?(a.prop("disabled",!0),i.prop("disabled",!0),f.recipient=e,f.shop=App.settings.name+"\n"+App.settings.address.street+"\n"+App.settings.address.city+" "+App.settings.address.zip+" "+App.settings.address.country+"\nTIN: "+App.settings.tin+"\nVAT: "+App.settings.vat+"\nPhone: "+App.settings.phone,i.html('<div class="mi-loader loading"></div>'),$.ajax({type:"POST",url:"/mod/mailreceipt",dataType:"json",data:f}).done(function(e){e.success?(i.html("Email sent"),i.addClass("sent")):(i.html("Email could not be sent. Try again"),i.prop("disabled",!1),console.log(e))}).fail(function(e){i.html("Email could not be sent. Try again"),i.prop("disabled",!1),console.log(e)})):a.addClass("invalid").val("Invalid email")}).appendTo(t);t.appendTo(m),$("<button>").attr("id","done-payment").text("Done").click(function(){y||window.print(),App.closeCurtain(),App.jPriceInput.focus()}).appendTo(m)}else App.closeCurtain(),App.showWarning("Server refused to sync"),console.log(e)}).fail(function(e){App.closeCurtain(),console.log(e),App.showWarning("Sale sync failed: "+e.status)}))}).appendTo(m),m.appendTo(t),$("<div>").addClass("receipt-container").append(a).appendTo(t),t.appendTo(e),App.showInCurtain(e),App.jCashInput.focus(),App.beep()});var A=App.catalog.articles;App.nArticles=A.length;for(var d=0;d<App.nArticles;d++)A[d].id=d;A.sort(App.sortByEAN),App.jSearchBox=App.jLiveSearch.find("#search"),App.jSearchBox.keyup(function(e){var t=$(this);if(13===e.keyCode){var a=t.val(),i=A.binaryIndexOf("ean",a);if(i>=0){var n=A[i],p=App.getMultiplicationNumber();App.addItemToCheckout(n.id,n.ean,n.name,n.price,n.group,n.tax,n.tags,n.desc,p),t.removeClass("not-found"),t.attr("placeholder","PLU"),App.isInRegistrySession=!1,App.jPriceInput.blur(),App.jPriceInput.val(n.price)}else t.attr("placeholder","PLU not found");t.val("")}else 27===e.keyCode&&t.blur()}).keydown(function(e){e.stopPropagation()}).click(function(){$(this).removeClass("not-found"),$(this).attr("placeholder","PLU")}).focus(function(){$(this).removeClass("not-found"),$(this).attr("placeholder","PLU")}),$(document).scannerDetection(function(e){clearTimeout(App._scannerTimingOut),App.jSearchBox.blur(),App.justUsedScanner=!0,App._scannerTimingOut=setTimeout(function(){App.justUsedScanner=!1},App._timeBetweenConsecutiveScannings),App.closeCurtain(),App.jSearchBox.val(e),App.jSearchBox.trigger(App.simulateEnterKeyup()),App.isInRegistrySession=!0}),$("#logout").click(function(){
App.renderDashBoard()})},App.createCenterBox=function(e,t){return'<div class="center-box'+(e?" scrollable":"")+'">'+t+"</div>"},App.renderDashBoard=function(){App.closeCurtain();var e='<nav>                <div id="logo"><div class="logo"></div></div>                <div id="brand">EnterpriseApps</div>                <div id="menu-top">                    <div id="profile">'+App.settings.name+'</div>                    <div id="sign-out">Sign out</div>                </div>             </nav>'+App.createCenterBox(!1,'<div class="form-header">Open Cash Register</div>                <form id="employee-login" action="">                    <div class="form-label">EMPLOYEE LOGIN</div>                    <input id="employee-username" type="text" title="Employee username " placeholder="USERNAME">                    <input id="employee-pin" type="password" placeholder="PIN">                    <input type="submit" value="OK">                </form>');App.jAppContainer.html(e);var t=$("#employee-login"),a=t.find("#employee-username");t.submit(function(e){e.preventDefault();for(var a=t.find("#employee-username"),i=t.find("#employee-pin"),n=!1,p=App.staff.length,r=0;p>r;r++){var s=App.staff[r];if(s.name===a.val()&&s.pin===i.val()){App.currentEmployee=s,n=!0;break}}n?App.renderWebRegister():App.showWarning("Invalid Employee Name or PIN")}),$("#sign-out").click(function(){App.showLoading(),$.ajax({type:"GET",url:"/signout"}).done(function(){App.renderSignin()}).fail(function(){App.closeCurtain(),App.showWarning("Unable to sign out. Please check your connection")})}),a.focus()},App.initDashBoard=function(){$.when($.getJSON("/api/catalog",function(e){App.catalog=e}),$.getJSON("/api/settings",function(e){App.settings=e,App.staff=e.staff,App.receipt=e.receipt}),$.getJSON("/api/buttons",function(e){App.buttons=e}),$.getJSON("/api/sales",function(e){App.sales=e})).then(function(){App.renderDashBoard()})},App.showLoading=function(){App.showInCurtain(App.loadingScreen)},App.emailRegex=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,App.isValidEmail=function(e){return["guest"].indexOf(e)>=0?!0:App.emailRegex.test(e)},App.renderSignin=function(){App.closeCurtain();var e=App.createCenterBox(!1,'<div class="form-header">Welcome to OPS</div>                <form id="sign-in" action="" method="POST">                    <div class="form-label">OPEN YOUR STORE</div>                    <input id="username" type="text" placeholder="EMAIL">                    <input id="password" type="password" placeholder="PASSWORD">                    <input type="submit" value="SIGN IN">                    <div id="form-help">                        <div id="signup">Sign up</div>                        <div id="forgot">Forgot your password?</div>                    </div>                </form>                <div class="form-footer">Powered by EnterpriseApps</div>');App.jAppContainer.html(e);var t=$("#sign-in");t.find("#forgot").click(function(){App.renderForgot()}),t.find("#signup").click(function(){App.renderSignup()}),t.submit(function(e){e.preventDefault();var t=$(this),a=t.find("#username").val(),i=t.find("#password").val();App.isValidEmail(a)&&i.length?(App.showLoading(),$.ajax({type:"POST",url:"/auth",dataType:"json",data:{username:a||" ",password:i||" "}}).done(function(e){e.isAuthenticated?App.initDashBoard():alert("Wrong credentials")}).fail(function(e){App.closeCurtain();var t="Incorrect username and/or password";0===e.status&&(t="Network error. Please check your internet connection"),App.showWarning(t)})):App.showWarning("Please enter your email and password to sign in"),t.find("#password").val("")})},App.renderSignup=function(){var e=App.createCenterBox(!0,'<div class="form-header">Welcome to OPS</div>                <form id="sign-up" action="" method="POST">                    <div class="form-label">CREATE A NEW STORE</div>                    <input id="username" type="text" placeholder="EMAIL" required>                    <input id="password" type="password" placeholder="PASSWORD" pattern=".{8,128}" title="Password must be at least 8 characters long" required>                    <input id="confirm" type="password" placeholder="CONFIRM PASSWORD" pattern=".{8,128}" title="Password must be at least 8 characters long" required>                    <input id="name" type="text" placeholder="Name" pattern=".{3,100}" title="Your Best World Shop, Inc." required>                    <input id="tin" type="text" placeholder="Taxpayer Identification Number" pattern="\\d{8}" title="Invalid TIN. Example: 12345678" required>                    <input id="vat" type="text" placeholder="Value Added Tax Number" pattern="[A-Z]{2}\\d{8,10}" title="Invalid VAT. Example: CZ1234567890" required>                    <input id="street" type="text" placeholder="Street and Property Number" pattern=".{5,100}" title="Example: Spálená 78/12" required>                    <input id="city" type="text" placeholder="City" pattern=".{2,75}" title="Example: Prague" required>                    <input id="zip" type="text" placeholder="ZIP Code" pattern="\\w{3,10}" title="Example: 18000" required>                    <input id="country" type="text" placeholder="Country" pattern=".{3,75}" title="Example: Czech Republic" required>                    <input id="phone" type="text" placeholder="Phone Number" pattern="\\+?(\\d{3})?\\d{9}" title="9 or +12 Digits Phone Number. Example: 777666555, +420777666555" required>                    <select id="currency">                        <option data=\'{"code":"CZK","symbol":"Kč"}\' selected>CZK - Czech Koruna</option>                    </select>                    <input type="submit" value="SIGN UP">                    <div id="form-help">                        <div id="signin">Back to sign in</div>                    </div>                </form>                <div class="form-footer">Powered by EnterpriseApps</div>');App.jAppContainer.html(e);var t=$("#sign-up");t.find("#signin").click(function(){App.renderSignin()}),t.submit(function(e){e.preventDefault();var t=$("#username");if(!App.isValidEmail(t.val()))return App.showWarning("<strong>"+t.val()+"</strong> is not a valid emaill address!"),!1;var a=$("#password"),i=$("#confirm");if(a.val()!==i.val())return App.showWarning("Passwords do not match!"),!1;var n={email:t.val(),password:a.val(),name:$(this).find("#name").val(),tin:$(this).find("#tin").val(),vat:$(this).find("#vat").val(),street:$(this).find("#street").val(),city:$(this).find("#city").val(),zip:$(this).find("#zip").val(),country:$(this).find("#country").val(),phone:$(this).find("#phone").val(),currency:$(this).find("#currency").find(":selected").attr("data")};App.showLoading(),$.ajax({type:"POST",url:"/signup",dataType:"json",data:n}).done(function(e){e.success?(App.renderSignin(),App.showWarning("Thank you for creating an account<br>Please check your inbox at <strong>"+e.msg+"</strong> to complete the registration")):(App.closeCurtain(),App.showWarning("Unable to create account<br><strong>"+e.msg+"</strong><br>Please let us know at <a href='mailto:info.enterpriseapps@gmail.com'>info.enterpriseapps@gmail.com</a>"))}).fail(function(e){App.closeCurtain();var t="Incorrect username and/or password";0===e.status&&(t="Network error. Please check your internet connection"),App.showWarning(t)})})},App.renderForgot=function(){var e=App.createCenterBox(!1,'<div class="form-header">Welcome to OPS</div>                <form id="reset-password" action="" method="POST">                    <div class="form-label">RESET PASSWORD</div>                    <input id="username" type="text" placeholder="EMAIL" required>                    <input type="submit" value="SUBMIT">                    <div id="form-help">                        <div id="signin">Back to sign in</div>                    </div>                </form>                <div class="form-footer">Powered by EnterpriseApps</div>');App.jAppContainer.html(e);var t=$("#reset-password");t.find("#signin").click(function(){App.renderSignin()}),t.submit(function(e){e.preventDefault();var t=$("#username");return App.isValidEmail(t.val())?(App.showLoading(),void $.ajax({type:"POST",url:"/forgot",dataType:"json",data:{email:t.val()}}).done(function(e){e.success?(App.renderSignin(),App.showWarning("A reset link has been sent to your inbox at <strong>"+e.msg+"</strong>")):(App.closeCurtain(),App.showWarning("Unable to process your request<br><strong>"+e.msg+"</strong><br>Please let us know at <a href='mailto:info.enterpriseapps@gmail.com'>info.enterpriseapps@gmail.com</a>"))}).fail(function(e){var t="Request failed. "+e.status;0===e.status&&(t="Network error. Please check your internet connection"),App.closeCurtain(),App.showWarning(t)})):(App.showWarning("<strong>"+t.val()+"</strong> is not a valid emaill address!"),!1)})},function(){var e=function(){},t=function(){App.jPrinterCopyReceipt&&(App.closeCurtain(),App.jPrinterCopyReceipt=null)};if(window.matchMedia){var a=window.matchMedia("print");a.addListener(function(a){a.matches?e():t()})}window.onbeforeprint=e,window.onafterprint=t}(),App.createControlPanel=function(){var e='<div class="cp-item" id="sale-history">Sales History</div>                    <div class="cp-item" id="close-register">Close Register</div>';"Admin"===App.currentEmployee.role&&(e+='<div class="cp-item" id="acc-settings">Account Settings</div>                <div class="cp-item" id="sta-settings">Staff Settings</div>                <div class="cp-item" id="pos-settings">Point of Sale Settings</div>                <div class="cp-item" id="plu-settings">Edit PLU Articles</div>                <div class="cp-item" id="sgs-settings">Edit Sale Groups</div>                <div class="cp-item" id="qss-settings">Edit Quick Sales</div>                <div class="cp-item" id="rec-settings">Edit Receipt</div>'),App.cpBody.append($(e)),App.bindControlPanel()},App.bindControlPanel=function(){App.cpBody.find(".cp-item").each(function(){var e=$(this),t=e.attr("id");switch(t){case"sale-history":e.click(App.renderSaleHistory);break;case"close-register":e.click(function(){e.text("Not available")});break;case"acc-settings":e.click(App.renderAccountSettings);break;case"sta-settings":e.click(App.renderStaffSettings);break;case"pos-settings":e.click(App.renderPOSSettings);break;case"plu-settings":e.click(App.renderPLUSettings);break;case"sgs-settings":e.click(App.renderSaleGroupsSettings);break;case"qss-settings":e.click(function(){e.text("Not available")});break;case"rec-settings":e.click(App.renderReceiptSettings)}})},App.createGoBack=function(e){return $('<div id="go-back">Go back</div>').click(function(){e&&e(),App.cpBody.html(""),App.createControlPanel()})},App.renderAccountSettings=function(){var e=App.createCenterBox(!1,'<div class="form-header">Account Settings</div>                <form id="change-password" action="" method="POST">                    <div class="form-label">CHANGE YOUR PASSWORD</div>                    <input id="old-password" type="password" pattern=".{8,128}" title="Password must be at least 8 characters long" placeholder="OLD PASSWORD">                    <input id="new-password" type="password" pattern=".{8,128}" title="Password must be at least 8 characters long" placeholder="NEW PASSWORD">                    <input id="con-password" type="password" pattern=".{8,128}" title="Password must be at least 8 characters long" placeholder="CONFIRM PASSWORD">                    <input type="submit" value="SUBMIT">                </form>');App.cpBody.html(e),App.cpBody.find(".center-box").prepend(App.createGoBack()),App.cpBody.find("#change-password").submit(function(e){e.preventDefault();var t=$(this),a=t.find("#old-password"),i=t.find("#new-password"),n=t.find("#con-password");return i.val().length<8||n.val().length<8||a.val().length<8?(App.showWarning("The minimum length for a password is 8 characters"),!1):i.val()!==n.val()?(App.showWarning("Passwords do not match"),!1):(App.showLoading(),$.ajax({type:"POST",url:"/mod/changepassword",dataType:"json",data:{oldpassword:a.val(),newpassword:i.val()}}).done(function(e){App.closeCurtain(),e.passwordChanged===!0?App.showWarning("Password was successfully changed"):App.showWarning(e.msg)}).fail(function(e){App.closeCurtain();var t="The password is invalid";0===e.status&&(t="Network error. Please check your internet connection"),App.showWarning(t)}),a.val(""),i.val(""),void n.val(""))}).click(function(e){e.stopPropagation()})},App.resetRequestButtons=function(e){e.find("button").each(function(){var e=$(this);e.removeClass("fail success"),e.hasClass("mi-save")?e.find("span").text("Save"):e.hasClass("mi-remove")&&e.find("span").text("Remove")})},App.requestModifyItem=function(e,t,a){var i="save"===t.requestType,n=i?"Saving":"Removing",p=i?"Saved":"Removed",r=i?"Save failed":"Remove failed";"import"===t.requestType&&(n="Importing",p="Imported",r="Import failed");var s=a.find(".mi-loader"),d=a.find("span");s.addClass("loading"),a.removeClass("fail success"),d.html(n),$.ajax({type:"POST",url:e,dataType:"json",data:t}).done(function(n){if(n.success){switch(s.removeClass("loading"),a.addClass("success"),d.html(p),e){case"/mod/staff":App.staff=n.msg;break;case"/mod/receipt":App.receipt=n.msg;break;case"/mod/pos":App.settings=n.msg;break;case"/mod/plu":var o=n.msg,l=App.catalog.articles,c=l.binaryIndexOf("ean",n.msg.ean);if(i)if(c>=0)o.id=l[c].id,l[c]=o;else{o.id=App.nArticles,App.nArticles++,l.push(o),l.sort(App.sortByEAN);var u=a.parents().eq(2);u.find("input[placeholder='EAN']").prop("disabled",!0),u.find(".mi-header").removeClass("new-item")}else c>=0&&l.splice(c,1);break;case"/mod/pluimport":App.catalog=n.msg,App.catalog.articles.sort(App.sortByEAN);break;case"/mod/salegroups":var v=App.buttons.saleGroups;if("new sg"===t._id)a.parents().eq(1).find("input[placeholder='_ID']").val(n.msg._id),v.push(n.msg);else for(var m=0;m<v.length;m++)if(v[m]._id===n.msg._id){i?v[m]=n.msg:v.splice(m,1);break}App.renderSaleGroupsButtons()}"remove"===t.requestType&&a.parents().eq(2).slideUp(App.getAnimationTime(),function(){$(this).remove()})}else s.removeClass("loading"),a.addClass("fail"),d.html(r+"<br>Reason: "+n.msg)}).fail(function(e){s.removeClass("loading"),a.addClass("fail"),d.html(r+"<br>Status: "+e.status+" "+e.responseText),0===e.status&&(App.closeCurtain(),App.showWarning("Network error. Server may be down or your internet connection is lost"))})},App.generateModItemFormDOM=function(e,t){var a=[],i=[],n="",p="";switch(e){case"staff":a=["number"];break;case"receipt":n="Tip: Use '&lt;br&gt;' to add new lines";break;case"pos":break;case"plu":a=["ean"];break;case"newplu":p=" new-item";break;case"salegroups":a=["_id"],i=["_id"]}var r=["Admin","Seller"],s=t.number&&0===t.number.value&&t.role&&"Admin"===t.role.value,d="receipt"===e,o="pos"===e,l="salegroups"===e,c=["staff","salegroups"].indexOf(e)>=0,u=t.name?t.name.value:e.toUpperCase();u=t.ean?t.ean.value:u,l&&(u=t.group?t.group.value:u);for(var v=Object.keys(t),m='<form class="mod-item" action method="POST">                    <div class="mi-header'+p+'">'+u+'</div>                    <div class="mi-body'+(c?" hidden":"")+'">                    <div class="mi-info">'+n+"</div>",f=0;f<v.length;f++){var A=a.indexOf(v[f])>=0,h=i.indexOf(v[f])>=0,g=s&&"role"===v[f],b=0;switch(v[f]){case"pin":b=4;break;default:b=0}if(m+='<div class="mi-row'+(h?" hidden":"")+'">                            <div class="mi-row-label">'+v[f].toUpperCase()+"</div>","currency"===v[f])m+='<select id="currency">                                <option data=\'{"code":"CZK","symbol":"Kč"}\' selected>CZK - Czech Koruna</option>                            </select>';else if("role"===v[f]){m+='<select id="roles">';for(var y=0;y<r.length;y++)m+="<option"+(r[y]===t[v[f]].value?" selected":"")+(s?" disabled":"")+">"+r[y]+"</option>";m+="</select>"}else if("tax"===v[f]){m+='<select id="tax_rates">';for(var C=App.settings.tax_rates,y=0;y<C.length;y++)m+="<option"+(C[y]===t[v[f]].value?" selected":"")+">"+C[y]+"</option>";m+="</select>"}else if("bg"===v[f])m+='<div class="colpicker"                                 placeholder="'+v[f].toUpperCase()+'">'+t[v[f]].value+"</div>";else{var x=t[v[f]].valid.toString().replace(/[\/^$]/g,"");m+='<input class=""                                    type="text"                                    pattern="'+x+'"                                    title="'+t[v[f]].title+'"                                    placeholder="'+v[f].toUpperCase()+'"                                    value="'+t[v[f]].value+'"'+(A||g?" disabled":"")+(b?' maxLength="'+b+'"':"")+(h?"":" required")+">"}m+="</div>"}return m+='<div class="mi-control">                            <button class="mi-save">                                <span>Save</span>                                <div class="mi-loader"></div>                            </button>                            <button class="mi-remove" '+(s||d||o||p?"disabled":"")+'>                                <span>Remove</span>                                <div class="mi-loader"></div>                            </button>                        </div>                    </div>                </form>'},App.prepareSubmit=function(e,t,a){return{dataFunction:e,button:t,requestType:a}},App.bindModSettings=function(e,t){var a=null;e.find("form.mod-item").submit(function(e){e.preventDefault();var i=a.dataFunction(a.requestType,a.button);App.requestModifyItem(t,i,a.button)});var i=e.find(".modifier");switch(i.find(".mi-header").click(function(){var e=$(this);e.next(".mi-body").slideToggle(200)}),i.find("input").change(function(){App.resetRequestButtons($(this).parents().eq(1))}),t){case"/mod/staff":e.find(".adder").click(function(){var e=App.findMaxEmployeeNumber(i),n=$(App.generateModItemFormDOM("staff",{role:{title:"Admin or Seller",valid:/^(Admin|Seller)$/,value:"Seller"},number:{title:"1-4 digits",valid:/^\d{1,4}$/,value:e+1},name:{title:"3 or more characters",valid:/^.{3,50}$/,value:"Employee "+(e+1)},pin:{title:"4 digits",valid:/^\d{4}$/,value:"0000"}}));n.submit(function(e){e.preventDefault();var i=a.dataFunction(a.requestType,a.button);App.requestModifyItem(t,i,a.button)}),n.find("input").change(function(){App.resetRequestButtons(n)}),n.find(".mi-header").click(function(){$(this).next(".mi-body").slideToggle(200)}),n.find("button.mi-save").click(function(){a=App.prepareSubmit(App.getMiEmployeeUpdateData,$(this),"save")}).click(),n.find("button.mi-remove").click(function(){a=App.prepareSubmit(App.getMiEmployeeUpdateData,$(this),"remove")}),n.hide().appendTo(i).slideDown(App.getAnimationTime())}),i.find("button.mi-save").click(function(){a=App.prepareSubmit(App.getMiEmployeeUpdateData,$(this),"save")}),i.find("button.mi-remove").click(function(){a=App.prepareSubmit(App.getMiEmployeeUpdateData,$(this),"remove")});break;case"/mod/receipt":i.find("button.mi-save").click(function(){a=App.prepareSubmit(App.getMiReceiptUpdateData,$(this),"save")});break;case"/mod/pos":i.find("button.mi-save").click(function(){a=App.prepareSubmit(App.getMiPosUpdateData,$(this),"save")});break;case"/mod/salegroups":e.find(".adder").click(function(){var e=$(App.generateModItemFormDOM("salegroups",{tax:{title:"1-50 characters",valid:/^(0|10|15|21)$/,value:15},group:{title:"1-50 characters",valid:/^.{1,50}$/,value:"New Group"},bg:{title:"Background color. Example: FFFFFF",valid:/^[A-Fa-f0-9]{6}$/,value:"BB5151"},_id:{title:"24 \\w",valid:/^\w{24}$/,value:"new sg"}}));e.submit(function(e){e.preventDefault();var i=a.dataFunction(a.requestType,a.button);App.requestModifyItem(t,i,a.button)}),e.find("input").change(function(){App.resetRequestButtons(e)}),e.find(".mi-header").click(function(){$(this).next(".mi-body").slideToggle(200)}),e.find("button.mi-save").click(function(){a=App.prepareSubmit(App.getMiSaleGroupUpdateData,$(this),"save")}).click(),e.find("button.mi-remove").click(function(){a=App.prepareSubmit(App.getMiSaleGroupUpdateData,$(this),"remove")}),e.find("div[placeholder='BG']").each(function(){var e=$(this);App.bindColpick(e)}),e.hide().appendTo(i).slideDown(App.getAnimationTime())}),i.find("button.mi-save").click(function(){a=App.prepareSubmit(App.getMiSaleGroupUpdateData,$(this),"save")}),i.find("button.mi-remove").click(function(){a=App.prepareSubmit(App.getMiSaleGroupUpdateData,$(this),"remove")})}},App.renderStaffSettings=function(){for(var e='<div class="form-header">Staff Settings</div>                <div class="mod-form">                    <div class="form-row">                        <div class="form-label">MANAGE YOUR TEAM</div>                        <div class="adder"></div>                    </div>                    <div class="modifier">',t=App.staff,a=0;a<t.length;a++){var i=t[a];e+=App.generateModItemFormDOM("staff",{role:{title:"Admin of Seller",valid:/^(Admin|Seller)$/,value:i.role},number:{title:"1-4 digits",valid:/^\d{1,4}$/,value:i.number},name:{title:"3 or more characters",valid:/^.{3,50}$/,value:i.name},pin:{title:"4 digits",valid:/^\d{4}$/,value:i.pin}})}e+="</div>                </div>",App.cpBody.html(App.createCenterBox(!0,e)),App.cpBody.find(".center-box").prepend(App.createGoBack());var n=App.cpBody.find(".mod-form"),p="/mod/staff";App.bindModSettings(n,p)},App.getMiEmployeeUpdateData=function(e,t){var a=t.parents().eq(1);return{requestType:e,role:a.find("select").find(":selected").val(),number:a.find("input[placeholder='NUMBER']").val(),name:a.find("input[placeholder='NAME']").val(),pin:a.find("input[placeholder='PIN']").val()}},App.findMaxEmployeeNumber=function(e){var t=0;return e.find("input[placeholder='NUMBER']").each(function(){var e=parseInt($(this).val());e>t&&(t=e)}),t},App.renderReceiptSettings=function(){var e=App.createCenterBox(!0,'<div class="form-header">Receipt Settings</div>                    <div class="mod-form" action="" method="POST">                        <div class="form-row">                            <div class="form-label">EDIT YOU RECEIPT</div>                        </div>                        <div class="modifier">'+App.generateModItemFormDOM("receipt",{header:{title:"Max 256 characters",valid:/^.{0,256}$/,value:App.receipt.header},footer:{title:"Max 256 characters",valid:/^.{0,256}$/,value:App.receipt.footer}})+"</div>                    </div>");App.cpBody.html(e),App.cpBody.find(".center-box").prepend(App.createGoBack());var t=App.cpBody.find(".mod-form"),a="/mod/receipt";App.bindModSettings(t,a)},App.getMiReceiptUpdateData=function(e,t){var a=t.parents().eq(1);return{requestType:e,header:a.find("input[placeholder='HEADER']").val(),footer:a.find("input[placeholder='FOOTER']").val()}},App.renderPOSSettings=function(){var e=App.createCenterBox(!0,'<div class="form-header">Point of Sale Settings</div>                    <div class="mod-form" action="" method="POST">                        <div class="form-row">                            <div class="form-label">Configure your Cash Register</div>                        </div>                        <div class="modifier">'+App.generateModItemFormDOM("pos",{name:{title:"3-100 characters",valid:/^.{3,100}$/,value:App.settings.name},tin:{title:"8 digits",valid:/^\d{8}$/,value:App.settings.tin},vat:{title:"Example: CZ1234567890",valid:/^[A-Z]{2}\d{8,10}$/,value:App.settings.vat},street:{title:"5-100 characters",valid:/^.{5,100}$/,value:App.settings.address.street},city:{title:"2-75 characters",valid:/^.{2,75}$/,value:App.settings.address.city},zip:{title:"3-10 letters",valid:/^\w{3,10}$/,value:App.settings.address.zip},country:{title:"3-75 characters",valid:/^.{3,75}$/,value:App.settings.address.country},phone:{title:"9 digits with optional prefix",valid:/^\+?(\d{3})?\d{9}$/,value:App.settings.phone},currency:{title:"",valid:/^\{"code":"(CZK)","symbol":"(Kč)"\}$/,value:App.settings.currency}})+"</div>                    </div>");App.cpBody.html(e),App.cpBody.find(".center-box").prepend(App.createGoBack());var t=App.cpBody.find(".mod-form"),a="/mod/pos";App.bindModSettings(t,a)},App.getMiPosUpdateData=function(e,t){var a=t.parents().eq(1);return{requestType:e,name:a.find("input[placeholder='NAME']").val(),tin:a.find("input[placeholder='TIN']").val(),vat:a.find("input[placeholder='VAT']").val(),street:a.find("input[placeholder='STREET']").val(),city:a.find("input[placeholder='CITY']").val(),zip:a.find("input[placeholder='ZIP']").val(),country:a.find("input[placeholder='COUNTRY']").val(),phone:a.find("input[placeholder='PHONE']").val(),currency:a.find("select").find(":selected").attr("data")}},App.checkAndTrimPluImportCSV=function(e,t,a){var i=e.split(t),n=["ean","name","price","group","tax"],p=i[0].split(a);if(p.length!==n.length)return{isValid:!1,msg:"Invalid CSV header format. Incorrect number of fields. Must be "+n.length};for(var r=0;r<p.length;r++)if(p[r]=p[r].trim(),p[r]!==n[r])return{isValid:!1,msg:"Invalid CSV header "+(r+1)+": "+p[r]+". Must be "+n[r]};for(var s=n.join(";"),d=[/^\d{1,13}$/,/^.{1,128}$/,/^\d{1,5}\.\d{2}$/,/^.{0,128}$/,/^(0|10|15|21)$/],o=[],r=1;r<i.length;r++){var l=i[r].split(a);if(d.length!==l.length)return{isValid:!1,msg:"Invalid format on line "+(r+1)+". Must have "+d.length+" values separated by semicolons (;)"};for(var c=0;c<d.length;c++){if(l[c]=l[c].trim(),!d[c].test(l[c]))return{isValid:!1,msg:"Invalid CSV on line "+(r+1)+", column: "+p[c]+", value: "+(l[c]||"/empty/")};"ean"===p[c]&&o.push({lineNumber:r+1,ean:l[c]})}s+="\n"+l.join(";")}o.sort(App.sortByEAN);for(var u=o.length-1,r=0;u>r;r++){var v=o[r],m=o[r+1];if(v.ean===m.ean)return{isValid:!1,msg:"EAN codes must be unique! Duplicate EAN codes on lines "+m.lineNumber+" and "+v.lineNumber}}return{isValid:!0,msg:s}},App.downloadTextFile=function(e,t){var a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),a.setAttribute("download",e),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)},App.renderPLUSettings=function(){var e='<div class="form-header">PLU Settings</div>                <div class="mod-form" action="" method="POST">                    <div class="form-row">                        <div class="form-label">MANAGE YOUR CATALOG</div>                    </div>                    <div class="form-row control">                        <button id="plu-import"><span>Import CSV</span><div class="mi-loader"></div></button>                        <input type="file" id="plu-import-input" accept=".csv"/>                        <button id="plu-export">Export CSV</button>                    </div>                    <div class="mi-info">Warning: Import will overwrite the current catalog!</div>                    <div class="hline"></div>                    <div class="mi-info">Tip: New PLU will be highlighted green if the EAN code is not found</div>                    <form class="form-row control">                        <input class="plu-searcher" placeholder="SEARCH EAN CODE" pattern="\\d{1,13}" title="EAN must have 1-13 digits">                        <button class="plu-search">Search / Add</button>                    </form>                    <div class="modifier"></div>                </form>';App.cpBody.html(App.createCenterBox(!0,e)),App.cpBody.find(".center-box").prepend(App.createGoBack());var t=App.cpBody.find(".mod-form"),a="/mod/plu",i=t.find(".modifier"),n=null;t.submit(function(e){e.preventDefault()});var p=t.find(".plu-searcher");t.find(".plu-search").click(function(){var e=p.val();if(p.val(""),e){var t=App.catalog.articles.binaryIndexOf("ean",e);if(i.empty(),t>=0){var r=App.catalog.articles[t],s=$(App.generateModItemFormDOM("plu",{ean:{title:"1-13 digits",valid:/^\d{1,13}$/,value:r.ean},name:{title:"1-128 characters",valid:/^.{1,128}$/,value:r.name},price:{title:"Example: 42.00",valid:/^\d{1,5}\.\d{2}$/,value:r.price},group:{title:"Max 128 characters",valid:/^.{0,128}$/,value:r.group},tax:{title:"",valid:/^(0|10|15|21)$/,value:r.tax}}));s.submit(function(e){e.preventDefault();var t=n.dataFunction(n.requestType,n.button);App.requestModifyItem(a,t,n.button)}),s.find("input").change(function(){App.resetRequestButtons(s)}),s.find(".mi-header").click(function(){$(this).next(".mi-body").slideToggle(200)}),s.find("button.mi-save").click(function(){n=App.prepareSubmit(App.getMiPluUpdateData,$(this),"save")}),s.find("button.mi-remove").click(function(){n=App.prepareSubmit(App.getMiPluUpdateData,$(this),"remove")}),s.hide().appendTo(i).slideDown(App.getAnimationTime())}else{var s=$(App.generateModItemFormDOM("newplu",{ean:{title:"1-13 digits",valid:/^\d{1,13}$/,value:e},name:{title:"1-128 characters",valid:/^.{1,128}$/,value:""},price:{title:"Example: 42.00",valid:/^\d{1,5}\.\d{2}$/,value:""},group:{title:"Max 128 characters",valid:/^.{0,128}$/,value:""},tax:{title:"",valid:/^(0|10|15|21)$/,value:App.settings.tax_rates[0]}}));s.submit(function(e){e.preventDefault();var t=n.dataFunction(n.requestType,n.button);App.requestModifyItem(a,t,n.button)}),s.find("input").change(function(){App.resetRequestButtons(s)}),s.find(".mi-header").click(function(){$(this).next(".mi-body").slideToggle(200)}),s.find("button.mi-save").click(function(){n=App.prepareSubmit(App.getMiPluUpdateData,$(this),"save")}),s.find("button.mi-remove").click(function(){n=App.prepareSubmit(App.getMiPluUpdateData,$(this),"remove")}),s.hide().appendTo(i).slideDown(App.getAnimationTime())}}});var r=t.find("#plu-import").click(function(){s.wrap("<form>").closest("form").get(0).reset(),s.unwrap(),s.click()}),s=t.find("#plu-import-input");s.change(function(e){var t=e.target.files,a=t[0],i=a.size,n=new FileReader;n.onload=function(){if(i>1e7)App.showWarning("File cannot be larger than 5 Megabytes");else{var e=App.checkAndTrimPluImportCSV(this.result,/[\n\r]+/,";");e.isValid?App.requestModifyItem("/mod/pluimport",{data:e.msg,requestType:"import"},r):(App.closeCurtain(),App.showWarning(e.msg))}},n.readAsText(a)}),t.find("#plu-export").click(function(){for(var e=App.catalog.articles,t=e.length,a="ean;name;price;group;tax",i=0;t>i;i++){var n=e[i];a+="\n"+n.ean+";"+n.name+";"+n.price+";"+n.group+";"+n.tax}App.downloadTextFile("catalog.csv",a)})},App.getMiPluUpdateData=function(e,t){var a=t.parents().eq(1);return{requestType:e,ean:a.find("input[placeholder='EAN']").val(),name:a.find("input[placeholder='NAME']").val(),price:a.find("input[placeholder='PRICE']").val(),group:a.find("input[placeholder='GROUP']").val(),tax:a.find("select").find(":selected").val()}},App.renderSaleGroupsSettings=function(){for(var e='<div class="form-header">Sale Groups Settings</div>                <div class="mod-form">                    <div class="form-row">                        <div class="form-label">MANAGE YOUR SALE GROUP BUTTONS</div>                        <div class="adder"></div>                    </div>                    <div class="modifier">',t=App.buttons.saleGroups,a=0;a<t.length;a++){var i=t[a];e+=App.generateModItemFormDOM("salegroups",{tax:{title:"1-50 characters",valid:/^(0|10|15|21)$/,value:i.tax},group:{title:"1-50 characters",valid:/^.{1,50}$/,value:i.group},bg:{title:"Background color. Example: FFFFFF",valid:/^[A-Fa-f0-9]{6}$/,value:i.bg},_id:{title:"24 \\w",valid:/^(\w{24}|new sg)$/,value:i._id}})}e+="</div>                </div>",App.cpBody.html(App.createCenterBox(!0,e)),App.cpBody.find(".center-box").prepend(App.createGoBack(function(){$(".colpick.colpick_full").remove()}));var n=App.cpBody.find(".mod-form"),p="/mod/salegroups";n.find("div[placeholder='BG']").each(function(){var e=$(this);App.bindColpick(e)}),App.bindModSettings(n,p)},App.getMiSaleGroupUpdateData=function(e,t){var a=t.parents().eq(1);return{requestType:e,tax:a.find("select").find(":selected").val(),group:a.find("input[placeholder='GROUP']").val(),bg:a.find("div[placeholder='BG']").text(),_id:a.find("input[placeholder='_ID']").val()}},App.bindColpick=function(e){e.colpick({color:e.text(),onSubmit:function(t,a,i,n,p){e.text(a.toUpperCase()),$(n).colpickHide();
},onChange:function(t,a,i,n,p){e.text(a.toUpperCase())}})},App.renderSaleHistory=function(){var e=App.createCenterBox(!1,'<div class="form-header">Sale history</div>                <div id="sale-history-container">                </div>');App.cpBody.html(e),App.cpBody.find(".center-box").prepend(App.createGoBack());for(var t=App.cpBody.find("#sale-history-container"),a=App.sales.receipts,i='<div class="history-receipt hr-header">                            <div class="hr-col">NUMBER</div>                            <div class="hr-col">DATE</div>                            <div class="hr-col">EMPLOYEE</div>                            <div class="hr-col">TOTAL PAID</div>                            <div class="hr-col">CONFIRMED</div>                            <div class="hr-col">RECEIPT</div>                       </div>',n=a.length-1;n>=0;n--){for(var p=a[n],r=0,s=p.items,d=0;d<s.length;d++)r+=parseFloat(s[d].price)*s[d].quantity;i+='<div class="history-receipt hr-row">                    <div class="hr-col hr-index">'+n+'</div>                    <div class="hr-col">'+p.number+'</div>                    <div class="hr-col">'+App.getDate(p.date)+'</div>                    <div class="hr-col">'+p.clerk+'</div>                    <div class="hr-col">'+r.formatMoney()+" "+App.settings.currency.symbol+'</div>                    <div class="hr-col">'+(p.confirmed?"YES":"NO")+'</div>                    <div class="hr-col hr-print" title="Print this receipt"></div>                </div>'}t.append(i),t.find(".hr-print").click(function(){var e=$(this),t=parseInt(e.parent().find(".hr-index").text());App.jPrinterCopyReceipt=App.renderHistoryReceipt(a[t]),App.showInCurtain(App.jPrinterCopyReceipt),window.print()})},App.renderHistoryReceipt=function(e){var t=e.items,a=$("<div>").addClass("receipt"),i=$('<div class="receipt-header">                    <div class="preview">Receipt Preview</div>                    <div class="company-name">'+App.settings.name+'</div>                    <div class="address-1">'+App.settings.address.street+'</div>                    <div class="address-2">'+App.settings.address.zip+" "+App.settings.address.city+'</div>                    <div class="receipt-row">                        <div class="tin">TIN: '+App.settings.tin+'</div>                        <div class="vat">VAT: '+App.settings.vat+"</div>                    </div>                </div>");$("<div>").addClass("receipt-custom-header").html(App.receipt.header+"<br><strong>RECEIPT COPY</strong>").appendTo(i),$("<div>").attr("id","receipt-number").text("Receipt #"+e.number).appendTo(i),a.append(i);for(var n=$("<ul>").addClass("receipt-body"),p={},r=App.settings.tax_rates.length,s=0;r>s;s++)p[App.settings.tax_rates[s]]={tax:null,total:null};for(var d=0,o=0,l=parseFloat(e.tendered),s=0;s<t.length;s++){var c=t[s],u=c.quantity;d+=parseFloat(u);var v=c.price,m=c.name,f=c.tax_rate,A=parseFloat(v)*parseFloat(u),h=$("<li>").addClass("receipt-item").append($("<div>").addClass("ri-n").text(m)).append($("<div>").addClass("ri-v").append($("<div>").addClass("ri-q").text(u)).append($("<div>").addClass("ri-x")).append($("<div>").addClass("ri-p").text(v)).append($("<div>").addClass("ri-tt").text(A.formatMoney())));n.append(h),p[f].tax+=parseFloat(A)*parseFloat(f)/100,p[f].total+=parseFloat(A),o+=A}n.appendTo(a);var g=$("<div>").attr("id","receipt-summary");$("<div>").attr("id","rs-total-items").append($("<div>").addClass("rs-label").text("Total items:")).append($("<div>").addClass("rs-value").text(d)).appendTo(g),$("<div>").attr("id","rs-total").append($("<div>").addClass("rs-label").text("Total amount:")).append($("<div>").addClass("rs-value").text(o.formatMoney())).appendTo(g),$("<div>").attr("id","rs-tender").append($("<div>").addClass("rs-label").text("Tendered:")).append($("<div>").addClass("rs-value").text(l.formatMoney())).appendTo(g),$("<div>").attr("id","rs-change").append($("<div>").addClass("rs-label").text("Change:")).append($("<div>").addClass("rs-value").text((l-o).formatMoney())).appendTo(g),$("<div>").attr("id","taxes-label").text("VAT summary:").appendTo(g),$("<div>").attr("id","tax-header").append($("<div>").addClass("th-rate").text("Rate")).append($("<div>").addClass("th-net").text("Net")).append($("<div>").addClass("th-value").text("Tax")).append($("<div>").addClass("th-total").text("Total")).appendTo(g);for(var b=Object.keys(p),y=b.length,s=0;y>s;s++)null!==p[b[s]].tax&&$("<div>").addClass("rs-tax").append($("<div>").addClass("rs-tax-rate").text(b[s]+"%")).append($("<div>").addClass("rs-tax-net").text((p[b[s]].total.toFixed(2)-p[b[s]].tax.toFixed(2)).toFixed(2))).append($("<div>").addClass("rs-tax-tax").text(p[b[s]].tax.toFixed(2))).append($("<div>").addClass("rs-tax-total").text(p[b[s]].total.toFixed(2))).appendTo(g);g.appendTo(a),$("<div>").addClass("receipt-clerk").text("Checked: "+e.clerk).appendTo(a),App.receiptTime=$("<div>").attr("id","receipt-time").text(App.getDate(e.date)).appendTo(a),$("<div>").addClass("receipt-gratitude").text(App.receipt.footer).appendTo(a),$("<div>").addClass("receipt-footer").text("EnterpriseApps").appendTo(a);var C=$("<div>").addClass("pb-body"),x=$("<div>").addClass("receipt-container");return x.append(a),C.append(x),$("<div id='payment-box'></div>").append(C)},App.Item=function(e,t,a,i,n,p,r,s){this.id=e,this.ean=t,this.name=a,this.price=i,this.group=n,this.tax=p,this.tags=r,this.desc=s},App.Item.prototype.valueOf=function(){return this.ean},$(document).ready(function(){App.init(),$.ajax({type:"POST",url:"/isAuthenticated"}).done(function(e){e.isAuthenticated?App.initDashBoard():App.renderSignin()})});